<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Login Google & Testar API</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>

  <h1>Login Google & Testar POST</h1>

  <button id="loginGoogle">Entrar com Google</button>
  <button id="fazerPost" disabled>Fazer POST para API</button>
  <button id="buscarProduto">Buscar Produto por ID</button>
  <button id="deletarProduto" disabled>Deletar Produto</button>

  <script>
    // Config do seu Firebase (substitua pelos seus dados)
    const firebaseConfig = {
      apiKey: "AIzaSyBSkzmG4PkefRFdvmDQopUlibyhonBI0t4",
      authDomain: "site-cha-e-encantos.firebaseapp.com",
      projectId: "site-cha-e-encantos",
      storageBucket: "site-cha-e-encantos.appspot.com",
      messagingSenderId: "983006416430",
      appId: "1:983006416430:web:8dbba5a8f82aacd19f59bf",
      measurementId: "G-2N72DMR5F8"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    
    let idToken = null;

    document.getElementById('loginGoogle').onclick = async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        idToken = await user.getIdToken();
        sessionStorage.setItem('idToken', idToken);
        alert(`Logado como: ${user.email}`);
        document.getElementById('fazerPost').disabled = false;
        document.getElementById('deletarProduto').disabled = false;
        document.getElementById('buscarProduto').disabled = false;
      } catch (error) {
        alert('Erro no login: ' + error.message);
      }
    };


    document.getElementById('fazerPost').onclick = () => {
      if(!idToken) {
        alert('Faça login primeiro!');
        return;
      }
      window.location.href = '../telaCadastroProduto/telaCadastroProduto.html';
    }


    document.getElementById('deletarProduto').onclick = async () => {
        if (!idToken) {
            alert('Faça login primeiro!');
            return;
        }

        const id = prompt("Digite o ID do produto que deseja deletar:");

        if (!id) {
            alert('ID não informado');
            return;
        }

        try {
            const response = await fetch(`https://site-cha-e-encantos-production.up.railway.app/produtos/${id}`, {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + idToken
            }
            });

            const json = await response.json();

            if (response.ok) {
            alert('Produto deletado com sucesso: ' + JSON.stringify(json));
            } else {
            alert('Erro: ' + JSON.stringify(json));
            }
        
        } catch (error) {
        alert('Erro na requisição: ' + error.message);
    }
    };

    document.getElementById('buscarProduto').onclick = async () => {
    const id = prompt("Digite o ID do produto que deseja buscar:");

    if (!id) {
      alert('ID não informado');
      return;
    }

    try {
      const response = await fetch(`https://site-cha-e-encantos-production.up.railway.app/produtos/${id}`, {
        method: 'GET'
      });

      if (response.ok) {
        const produto = await response.json();
        alert('Produto encontrado:\n' + JSON.stringify(produto, null, 2));
      } else if (response.status === 404) {
        alert('Produto não encontrado.');
      } else {
        const error = await response.json();
        alert('Erro: ' + JSON.stringify(error));
      }
    } catch (error) {
      alert('Erro na requisição: ' + error.message);
    }
    };
    </script>
</body>
</html>
